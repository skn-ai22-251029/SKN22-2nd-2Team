# EPIC 2. Data Understanding & Join Strategy (Minimal EDA)

본 문서는 가입 고객 이탈 예측 프로젝트의 **EPIC 2 단계**를 정리한 문서이다.  
EPIC 2의 목적은 탐색적 분석 자체가 아니라,  
**EPIC 1에서 정의한 예측 프레임이 실제 데이터 구조와 충돌하지 않는지 검증하고,  
이후 전처리 단계(EPIC 3)를 위한 명확한 데이터 결합 규칙을 확정**하는 것이다.

본 단계에서는 시각화 중심의 EDA를 수행하지 않으며,  
전처리 및 feature engineering에 필요한 **최소한의 데이터 점검만 수행**한다.

---

## 1. 사용 데이터셋 개요

본 프로젝트에서는 다음 네 개의 데이터셋을 사용한다.

- `train_v2.csv` : 사용자별 이탈 라벨 (`is_churn`)
- `members_v3.csv` : 사용자 정적 정보
- `user_logs_v2.csv` : 사용자 일별 서비스 이용 로그
- `transactions_v2.csv` : 사용자 결제 및 구독 이력

모든 테이블은 `msno`를 기준으로 사용자 단위로 연결된다.

---

## 2. 테이블별 시간 범위 확인

EPIC 1에서 정의한 관측 윈도우 및 예측 시점이 데이터셋과 일치하는지 확인한다.

### user_logs_v2
- 날짜 컬럼: `date` (YYYYMMDD)
- 데이터 기간: **2017-03-01 ~ 2017-03-31**

→ 로그 데이터 기반 관측 윈도우의 최대 길이는 **30일**로 제한된다.

### transactions_v2
- 날짜 컬럼: `transaction_date`, `membership_expire_date`
- 로그 데이터보다 긴 기간의 이력을 포함함

→ 거래 데이터는 **예측 시점(T) 이전 기록만 사용**한다.

---

## 3. 타겟 라벨 확인

### train_v2
- 구조: 1 user = 1 row
- 타겟 변수: `is_churn`

`is_churn`은 **예측 시점 T 이후의 이탈 여부를 반영한 결과값**이며,  
예측 윈도우의 정확한 기간은 데이터셋에 명시되어 있지 않다.

본 프로젝트에서는 제공된 라벨을 그대로 사용한다.

---

## 4. msno 기준 조인 관계 정리

모든 테이블은 `msno`를 기준으로 결합하지만,  
**테이블의 구조에 따라 조인 방식은 다르게 적용**한다.

### 4.1 기준 테이블 (Anchor)
- `train_v2`
- 최종 학습 데이터의 row 기준
- 1 user = 1 row 구조 유지

---

### 4.2 members_v3 (정적 테이블)
- 구조: 1 user = 1 row
- 시간 개념 없음

→ 별도 집계 없이 `LEFT JOIN`

---

### 4.3 user_logs_v2 (다중 row 테이블)
- 구조: `(msno, date)` 단위
- 1 user = 여러 row

→ 처리 원칙:
1. 관측 윈도우([2017-03-01, 2017-04-01)) 기준 필터링
2. 사용자(`msno`) 단위로 집계
3. 집계 결과를 `train_v2`에 `LEFT JOIN`

직접 조인은 수행하지 않는다.

---

### 4.4 transactions_v2 (다중 row + 상태 테이블)
- 구조: `(msno, transaction_date)` 단위
- 결제 상태 및 구독 정보 포함

→ 처리 원칙:
1. 예측 시점 T 이전 데이터만 사용
2. 사용자(`msno`) 단위로 집계 또는 최근 상태 요약
3. 집계 결과를 `train_v2`에 `LEFT JOIN`

---

## 5. 결측 데이터 해석 원칙

- 관측 윈도우 내 로그 또는 거래 데이터가 없는 경우:
  - row를 제거하지 않는다.
  - 해당 feature 값은 0 또는 명시적 결측값으로 처리한다.
- 이는 데이터 누락이 아닌 **“최근 활동 없음”이라는 의미 있는 신호**로 해석한다.

---

## 6. EPIC 2 단계의 산출물

본 단계의 결과로 다음 사항을 확정한다.

- 테이블별 실제 데이터 기간
- 관측 윈도우(30일)가 데이터셋과 일치함을 검증
- `msno` 기준 사용자 단위 결합 전략
- 집계 후 `LEFT JOIN` 원칙 확정

본 문서 이후 단계에서는 위 기준을 변경하지 않는다.

---

## 7. 다음 단계 안내

EPIC 2가 완료되면 다음 단계로 진행한다.

- EPIC 3: Data Preprocessing & Feature Engineering  
  - user_logs 30일 집계 feature 정의  
  - transactions 기반 구독/결제 feature 설계
