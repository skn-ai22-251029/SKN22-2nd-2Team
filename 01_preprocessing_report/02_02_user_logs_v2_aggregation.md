# User Logs 집계 결과 보고서

> **작성자**: 이도훈 (LDH)  
> **작성일**: 2025-12-16  
> **파일**: `user_logs_aggregated_ldh.parquet`

---

## 1. 개요

### 1.1 집계 목적
- 최근 서비스 이용 행태를 통해 **이탈 직전 행동 변화 포착**
- Churn의 단기 신호(short-term signal) 추출

### 1.2 집계 기준
| 항목 | 값 |
|------|-----|
| 기준 시점 (T) | 2017-03-31 |
| 관측 윈도우 | 2017-03-01 ~ 2017-03-31 (30일) |
| 집계 단위 | msno (사용자) |

---

## 2. 데이터 요약

### 2.1 Shape
```
(1,103,894 rows × 67 columns)
```

- **고유 사용자**: 1,103,894명
- **총 피처 수**: 67개 (msno 포함)
- **결측치**: 0개

### 2.2 메모리 사용량
```
564.3+ MB
```

---

## 3. 멀티 윈도우 전략

단일 30일 집계 대신 **Rolling Window 집계** 사용

| Window | 기간 | 목적 |
|--------|------|------|
| **W7** | 2017-03-25 ~ 03-31 | 최근 7일 행동 |
| **W14** | 2017-03-18 ~ 03-31 | 최근 14일 행동 |
| **W21** | 2017-03-11 ~ 03-31 | 최근 21일 행동 |
| **W30** | 2017-03-01 ~ 03-31 | 전체 30일 행동 |

---

## 4. 생성된 피처 목록 (67개)

### 4.1 기본 집계 피처 (각 윈도우별 10개 × 4 = 40개)

| 피처명 | 설명 |
|--------|------|
| `num_days_active_wX` | 활동 일수 |
| `total_secs_wX` | 총 청취 시간 (초) |
| `avg_secs_per_day_wX` | 일평균 청취 시간 |
| `std_secs_wX` | 청취 시간 표준편차 |
| `num_songs_wX` | 총 재생 곡 수 |
| `avg_songs_per_day_wX` | 일평균 재생 곡 수 |
| `num_unq_wX` | 고유 곡 수 |
| `num_25_wX` | 25% 미만 청취 곡 수 (스킵) |
| `num_100_wX` | 100% 청취 곡 수 (완주) |
| `short_play_wX` | 50% 미만 청취 곡 수 |

### 4.2 비율형 피처 (각 윈도우별 4개 × 4 = 16개)

| 피처명 | 설명 | 의미 |
|--------|------|------|
| `skip_ratio_wX` | 스킵율 (num_25 / total_songs) | 높으면 불만족 |
| `completion_ratio_wX` | 완주율 (num_100 / total_songs) | 높으면 만족 |
| `short_play_ratio_wX` | 50% 미만 청취 비율 | 높으면 불만족 |
| `variety_ratio_wX` | 다양성 (num_unq / total_songs) | 탐색 성향 |

### 4.3 변화량/추세 피처 (10개)

| 피처명 | 설명 | Churn 신호 |
|--------|------|-----------|
| `secs_trend_w7_w30` | 청취시간 추세 (7일/30일) | 낮으면 위험 |
| `secs_trend_w14_w30` | 청취시간 추세 (14일/30일) | 낮으면 위험 |
| `days_trend_w7_w14` | 활동일 추세 (7일/14일) | 낮으면 위험 |
| `days_trend_w7_w30` | 활동일 추세 (7일/30일) | 낮으면 위험 |
| `songs_trend_w7_w30` | 곡수 추세 (7일/30일) | 낮으면 위험 |
| `songs_trend_w14_w30` | 곡수 추세 (14일/30일) | 낮으면 위험 |
| `skip_trend_w7_w30` | 스킵율 변화 (7일 - 30일) | 높으면 위험 |
| `completion_trend_w7_w30` | 완주율 변화 (7일 - 30일) | 낮으면 위험 |
| `recency_secs_ratio` | 최근 7일 청취시간 비중 | 낮으면 위험 |
| `recency_songs_ratio` | 최근 7일 곡수 비중 | 낮으면 위험 |

---

## 5. 기술 통계 (30일 윈도우 기준)

### 5.1 주요 피처 통계

| 피처 | Mean | Std | Min | 25% | 50% | 75% | Max |
|------|------|-----|-----|-----|-----|-----|-----|
| `num_days_active_w30` | 16.66 | 10.30 | 1 | 7 | 18 | 26 | 31 |
| `total_secs_w30` | 131,733 | 185,227 | 0.3 | 13,115 | 67,936 | 173,934 | 2,406,313 |
| `num_songs_w30` | 642 | 829 | 1 | 73 | 354 | 877 | 11,490 |
| `skip_ratio_w30` | 0.20 | 0.18 | 0 | 0.06 | 0.15 | 0.29 | 1.0 |
| `completion_ratio_w30` | 0.80 | 0.18 | 0 | 0.71 | 0.85 | 0.94 | 1.0 |

### 5.2 추세 피처 통계

| 피처 | Mean | Std | 해석 |
|------|------|-----|------|
| `secs_trend_w7_w30` | 0.23 | 0.22 | 평균적으로 최근 7일이 전체의 23% |
| `recency_secs_ratio` | 0.23 | 0.22 | 동일 (7/30 ≈ 23%) |
| `skip_trend_w7_w30` | -0.05 | 0.19 | 평균적으로 스킵율 5%p 감소 |
| `completion_trend_w7_w30` | -0.10 | 0.28 | 평균적으로 완주율 10%p 감소 |

---

## 6. 데이터 타입

```
msno                     object (string)
num_days_active_w7       float64
total_secs_w7            float64
...
num_days_active_w30      int64
num_songs_w30            int64
num_unq_w30              int64
num_25_w30               int64
num_100_w30              int64
short_play_w30           int64
...
(나머지 float64)
```

> W30 일부 컬럼은 int64, 나머지는 float64 (윈도우 병합 시 NaN 처리로 인해)

---

## 7. 샘플 데이터 (head 5)

| msno | num_days_active_w7 | total_secs_w7 | skip_ratio_w7 | completion_ratio_w7 | recency_secs_ratio |
|------|-------------------|---------------|---------------|--------------------|--------------------|
| +++IZse... | 6.0 | 18,101 | 0.20 | 0.71 | 0.15 |
| +++hVY1... | 7.0 | 48,358 | 0.19 | 0.54 | 0.25 |
| +++l/EX... | 7.0 | 21,111 | 0.03 | 0.89 | 0.18 |
| +++snpr... | 3.0 | 8,591 | 0.29 | 0.48 | 0.06 |
| ++/9R3s... | 6.0 | 33,957 | 0.23 | 0.61 | 0.29 |

---

## 8. 이상치/결측치 처리

### 8.1 이상치 처리
- **Percentile 클리핑** (0.1% ~ 99.9%)
- 대상 컬럼: `total_secs`, `num_25`, `num_50`, `num_75`, `num_985`, `num_100`, `num_unq`

### 8.2 결측치 처리
| 상황 | 처리 방법 |
|------|----------|
| 특정 윈도우 활동 없음 | `fillna(0)` |
| 비율 계산 시 0 나눗셈 | `eps = 1e-9` 추가 |
| Inf 값 발생 | `replace([np.inf, -np.inf], 0)` |

---

## 9. 활용 방안

### 9.1 Churn 예측 핵심 피처 (추천)
1. `days_to_expire` (transactions) + `recency_secs_ratio` 조합
2. `skip_trend_w7_w30` - 스킵율 급증 사용자
3. `completion_trend_w7_w30` - 완주율 급감 사용자
4. `secs_trend_w7_w30` < 0.1 - 최근 사용량 급감

### 9.2 파생 피처 제안
```python
# 급감 플래그
df['usage_drop_flag'] = (df['secs_trend_w7_w30'] < 0.1).astype(int)

# 불만족 증가 플래그  
df['dissatisfaction_flag'] = (df['skip_trend_w7_w30'] > 0.1).astype(int)
```

---

## 10. 파일 정보

| 항목 | 값 |
|------|-----|
| 파일명 | `user_logs_aggregated.parquet` |
| 포맷 | Apache Parquet (PyArrow) |
| 위치 | `data/` |
| 생성일 | 2025-12-16 |

---

**End of Document**

