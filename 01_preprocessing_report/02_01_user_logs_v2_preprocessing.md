# user_logs_v2.csv 오류·이상치 처리 요약

본 문서는 `user_logs_v2.csv`를 대상으로 수행된 집계 과정에서,
오류 및 이상치가 **어떤 기준으로, 어느 단계에서 처리되었는지**를
간결하게 요약한다.

---

## 1. 처리 범위

- 대상 데이터: user_logs_v2.csv
- 집계 단위: msno (사용자)
- 기준 시점(T): 2017-04-01

---

## 2. 전체 처리 흐름

```
[원본 user_logs_v2]
        ↓
(1) 시간 조건 필터링
        ↓
(2) 사용자 단위 집계
        ↓
(3) 집계 결과 결측·이상치 처리
        ↓
[user-level feature table]
```

---

## 3. 집계 전 처리 (원본 로그 단계)

### 3.1 시간 조건 필터링

- 조건: date <= 2017-03-31
- 목적:
  - 데이터 누수 방지
  - 예측 프레임 일관성 유지

원본 로그 단계에서 수행된 **유일한 명시적 필터링**이다.

---

### 3.2 원본 로그 수준 이상치 제거 여부

다음과 같은 처리는 수행하지 않았다.

- total_secs 상한 컷
- 재생 카운트(num_25, num_50, num_75, num_985, num_100) 상한 컷
- 하루 단위 과도한 사용 로그 제거

이는 원본 로그의 극단값을
오류가 아닌 **사용자 행동의 일부로 간주**했기 때문이다.

---

## 4. 집계 단계 처리

### 4.1 사용자 단위 집계

- 집계 기준: (msno, date) → msno
- 주요 집계 방식:
  - 합계: total_secs, 재생 카운트
  - 평균 및 표준편차
  - 고유 곡 수(unique count)

효과:
- 하루 단위 노이즈 완화
- 일시적 극단값의 영향 감소

---

## 5. 집계 후 처리 (Feature Table 단계)

### 5.1 결측치 처리

| 상황 | 처리 방식 |
|------|-----------|
| 특정 윈도우 활동 없음 | fillna(0) |
| 비율 계산 시 0 나눗셈 | eps = 1e-9 |
| 무한대 값 발생 | inf 값을 0으로 치환 |

비활성 사용자(inactive user)는 의미 있는 0으로 유지한다.

---

### 5.2 이상치 처리

- 방식: Percentile clipping
- 범위: 0.1% ~ 99.9%
- 대상 컬럼:
  - total_secs
  - num_25, num_50, num_75, num_985, num_100
  - num_unq

특징:
- 사용자 단위 분포 기준 처리
- 원본 로그 손실 없이 꼬리 값만 완화

---

## 6. 처리 전략 요약

이 집계 방식의 핵심 원칙은 다음과 같다.

> 오류는 집계 전에 제거하고,
> 이상치는 집계 이후 분포 기준으로 처리한다.

- 시간 조건 위반 데이터는 명백한 오류로 사전 제거
- 사용량 폭발 등 극단값은 사용자 행동 가능성을 고려해 집계 후 처리

이는 user_logs_v2의 특성과 churn 예측 목적에 부합하는 전략이다.

---

## 7. 결론

- 집계 전 aggressive filtering은 수행하지 않음
- 시간 조건 필터링만 집계 전에 적용
- 결측치 및 이상치는 집계 이후 처리

본 처리 방식은 정보 손실을 최소화하면서,
안정적인 user-level feature 생성을 목표로 한다.

---

End of Document
